@using NewsSite.WebUi.HtmlHelpers;
@using Microsoft.AspNetCore.Mvc.Localization
@inject IViewLocalizer Localizer
@model NewsSite.WebUi.Models.PostViewModel
<!--To Work with icons-->
<link href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN" crossorigin="anonymous">

@{
    ViewData["Title"] = "ShowPost";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<div>
    <!-- Title -->
    <h1 class="mt-4">@Model.Post.Title</h1>

    <!-- Author -->
    <p class="lead">
        @Localizer["Posted on"]
        <a href="#">@Model.User.UserName</a>
    </p>

    <hr>

    <!-- Date/Time -->
    @*<p>Posted on January 1, 2018 at 12:00 PM</p>*@
    <p>@Localizer["Posted on"] @Model.Post.DateChanged.ToString("f") </p>

    <div>
        <a asp-controller="Admin" asp-action="Edit" asp-route-PostId="@Model.Post.PostId">Edit</a> |
        <a asp-action="List">Back to List</a>
    </div>

    <hr>

    <!-- Preview Image -->
    <img class="img-fluid rounded" src="@Url.Content(Model.Post.Path)" alt="">

    <hr>

    <!-- Post Content -->
    <p class="lead"><markdown markdown="@Model.Post.Text" /></p>

    <hr>

    <!-- Comments Form -->
    <div class="card my-4">
        <h5 class="card-header">@Localizer["Leave a Comment:"]</h5>
        <div class="card-body">
            <form asp-controller="Post" asp-action="AddComment" method="post">
                <input hidden="true" name="postId" value="@Model.Post.PostId" />
                <input hidden="true" name="UserId" value="@Model.CurrentUserId" />
                @*<input name="parentId" value="@Model.Comments." />*@
                <div class="form-group">
                    <textarea name="Text" class="form-control" rows="3"></textarea>
                </div>
                @if (User.Identity.IsAuthenticated)
                {
                <button type="submit" class="btn btn-primary">@Localizer["Submit"]</button>

                }
                else
                {
                    <p>чтобы оставить комментраий нужно авторизоваться</p>

                }
            </form>
        </div>
    </div>



    @foreach (var item in Model.Comments.Where(c => c.ParentId == null))
    {
        @*<div class="card">
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-2">
                            <img src="https://image.ibb.co/jw55Ex/def_face.jpg" class="img img-rounded img-fluid" />
                            <p class="text-secondary text-center">@item.PostedTime.ToShortTimeString()</p>
                        </div>
                        <div class="col-md-10">
                            <p>
                                <a class="float-left" href="https://maniruzzaman-akash.blogspot.com/p/contact.html"><strong>@Model.Users.Where(u => u.Id == item.UserID).First().UserName</strong></a>
                                <span class="float-right"><i class="text-warning fa fa-star"></i></span>
                                <span class="float-right"><i class="text-warning fa fa-star"></i></span>
                                <span class="float-right"><i class="text-warning fa fa-star"></i></span>
                                <span class="float-right"><i class="text-warning fa fa-star"></i></span>
                            </p>
                            <div class="clearfix"></div>
                            <p>@item.Text</p>
                            <p>
                                <a class="float-right btn btn-outline-primary ml-2"> <i class="fa fa-reply"></i> Reply</a>
                                <a class="float-right btn text-white btn-danger"> <i class="fa fa-heart"></i> Like</a>
                            </p>
                        </div>
                    </div>

                </div>
            </div>*@


        <!-- Single Comment -->
        <div class="media mb-4">
            @if (item.UserID != null) //поменять
            {
                <img class="d-flex mr-3 rounded-circle" src="@Model.Users.Where(u => u.Id == item.UserID).First().UrlImage" width="50">
            }

            <div class="media-body">
                <h5 class="mt-0">@Model.Users.Where(u => u.Id == item.UserID).First().UserName</h5>
                @item.Text
                @if (item.PostedTime != null)
                {
                    <p>@item.PostedTime</p>
                }

                    <a onclick="ShowCommentInput('@item.Id')">@Localizer["Reply"]</a>

                @Html.CreateComments(item, Model)

                <!-- Comments Form -->
                <div class="card my-4" id="@item.Id" style="display:none;">
                    <h5 class="card-header">Leave a Comment:</h5>
                    <div class="card-body">
                        <form asp-controller="Post" asp-action="AddComment" method="post">
                            <input name="postId" value="@item.Post.PostId" />
                            <input name="parentId" value="@item.Id" />
                            <input name="UserdId" value="@Model.CurrentUserId" />
                            <div class="form-group">
                                <textarea name="Text" class="form-control" rows="2"></textarea>
                            </div>
                            @if (User.Identity.IsAuthenticated)
                            {
                            <button type="submit" class="btn btn-primary">@Localizer["Submit"]</button>

                            }
                            else
                            {
                                <p>чтобы оставить комментраий нужно авторизоваться</p>

                            }


                        </form>
                    </div>
                </div>

            </div>
        </div>
    }

    <!-- Comment with nested comments -->
    @*<div class="media mb-4">
            <img class="d-flex mr-3 rounded-circle" src="http://placehold.it/50x50" alt="">
            <div class="media-body">
                <h5 class="mt-0">Commenter Name</h5>
                Cras sit amet nibh libero, in gravida nulla. Nulla vel metus scelerisque ante sollicitudin. Cras purus odio, vestibulum in vulputate at, tempus viverra turpis. Fusce condimentum nunc ac nisi vulputate fringilla. Donec lacinia congue felis in faucibus.

                <div class="media mt-4">
                    <img class="d-flex mr-3 rounded-circle" src="http://placehold.it/50x50" alt="">
                    <div class="media-body">
                        <h5 class="mt-0">Commenter Name</h5>
                        Cras sit amet nibh libero, in gravida nulla. Nulla vel metus scelerisque ante sollicitudin. Cras purus odio, vestibulum in vulputate at, tempus viverra turpis. Fusce condimentum nunc ac nisi vulputate fringilla. Donec lacinia congue felis in faucibus.
                    </div>
                </div>

                <div class="media mt-4">
                    <img class="d-flex mr-3 rounded-circle" src="http://placehold.it/50x50" alt="">
                    <div class="media-body">
                        <h5 class="mt-0">Commenter Name</h5>
                        Cras sit amet nibh libero, in gravida nulla. Nulla vel metus scelerisque ante sollicitudin. Cras purus odio, vestibulum in vulputate at, tempus viverra turpis. Fusce condimentum nunc ac nisi vulputate fringilla. Donec lacinia congue felis in faucibus.
                    </div>
                </div>

            </div>
        </div>*@

</div>

<script>
    function ShowCommentInput(id) {
        $("#" + id).show();
    }
</script>




