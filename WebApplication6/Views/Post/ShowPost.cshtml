@using NewsSite.WebUi.HtmlHelpers;
@model NewsSite.WebUi.Models.PostViewModel


@{
    ViewData["Title"] = "ShowPost";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<div>
    <!-- Title -->
    <h1 class="mt-4">@Model.Post.Title</h1>

    <!-- Author -->
    <p class="lead">
        by
        <a href="#">Start Bootstrap</a>
    </p>

    <hr>

    <!-- Date/Time -->
    @*<p>Posted on January 1, 2018 at 12:00 PM</p>*@
    <p>Posted on @Model.Post.DateChanged.ToString("MMMM' 'dd', 'yyyy' at 'hh':'mm' '") </p>

    <div>
        <a asp-controller="Admin" asp-action="Edit" asp-route-PostId="@Model.Post.PostId">Edit</a> |
        <a asp-action="List">Back to List</a>
    </div>

    <hr>

    <!-- Preview Image -->
    <img class="img-fluid rounded" src="http://placehold.it/900x300" alt="">

    <hr>

    <!-- Post Content -->
    <p class="lead"><markdown markdown="@Model.Post.Text" /></p>

    <hr>

    <!-- Comments Form -->
    <div class="card my-4">
        <h5 class="card-header">Leave a Comment:</h5>
        <div class="card-body">
            <form asp-controller="Post" asp-action="AddComment" method="post">
                <input name="postId" value="@Model.Post.PostId" />
                @*<input name="parentId" value="@Model.Comments." />*@
                <div class="form-group">
                    <textarea name="Text" class="form-control" rows="3"></textarea>
                </div>
                <button type="submit" class="btn btn-primary">Submit</button>
            </form>
        </div>
    </div>

    @foreach (var item in Model.Comments.Where(c => c.ParentId==null))
    {
        <!-- Single Comment -->
        <div class="media mb-4">
            <img class="d-flex mr-3 rounded-circle" src="http://placehold.it/50x50" alt="">
            <div class="media-body">
                <h5 class="mt-0">Commenter Name</h5>
                @item.Text
                <a onclick="ShowCommentInput('@item.Id')">Reply</a>

                @Html.CreateCommets(item, Model)

                <!-- Comments Form -->
                <div class="card my-4" id="@item.Id" style="display:none;">
                    <h5 class="card-header">Leave a Comment:</h5>
                    <div class="card-body">
                        <form asp-controller="Post" asp-action="AddComment" method="post">
                            <input name="postId" value="@item.Post.PostId" />
                            <input name="parentId" value="@item.Id" />
                            <div class="form-group">
                                <textarea name="Text" class="form-control" rows="2"></textarea>
                            </div>
                            <button type="submit" class="btn btn-primary">Submit</button>
                        </form>
                    </div>
                </div>

            </div>
        </div>
    }


    <!-- Comment with nested comments -->
    @*<div class="media mb-4">
            <img class="d-flex mr-3 rounded-circle" src="http://placehold.it/50x50" alt="">
            <div class="media-body">
                <h5 class="mt-0">Commenter Name</h5>
                Cras sit amet nibh libero, in gravida nulla. Nulla vel metus scelerisque ante sollicitudin. Cras purus odio, vestibulum in vulputate at, tempus viverra turpis. Fusce condimentum nunc ac nisi vulputate fringilla. Donec lacinia congue felis in faucibus.

                <div class="media mt-4">
                    <img class="d-flex mr-3 rounded-circle" src="http://placehold.it/50x50" alt="">
                    <div class="media-body">
                        <h5 class="mt-0">Commenter Name</h5>
                        Cras sit amet nibh libero, in gravida nulla. Nulla vel metus scelerisque ante sollicitudin. Cras purus odio, vestibulum in vulputate at, tempus viverra turpis. Fusce condimentum nunc ac nisi vulputate fringilla. Donec lacinia congue felis in faucibus.
                    </div>
                </div>

                <div class="media mt-4">
                    <img class="d-flex mr-3 rounded-circle" src="http://placehold.it/50x50" alt="">
                    <div class="media-body">
                        <h5 class="mt-0">Commenter Name</h5>
                        Cras sit amet nibh libero, in gravida nulla. Nulla vel metus scelerisque ante sollicitudin. Cras purus odio, vestibulum in vulputate at, tempus viverra turpis. Fusce condimentum nunc ac nisi vulputate fringilla. Donec lacinia congue felis in faucibus.
                    </div>
                </div>

            </div>
        </div>*@

</div>

<script>
    function ShowCommentInput(id) {
        $("#" + id).show();
    }
</script>




